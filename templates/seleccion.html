<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elige tu Camino | Pymax Corp</title>
  
  <link rel="icon" href="data:,">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    :root {
      --bg-void: #030014;
      --glass-border: rgba(255, 255, 255, 0.08);
      --accent-gold: #fbbf24;
      --accent-cyan: #06b6d4;
    }

    /* SCROLL FIX: Permitimos scroll suave y evitamos cortes */
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-void);
      color: #e2e8f0;
      min-height: 100vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    h1, h2, h3, .font-future { font-family: 'Outfit', sans-serif; letter-spacing: -0.02em; }

    /* FONDO NEBULA FIJO */
    .nebula-bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      background: 
        radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 85% 30%, rgba(6, 182, 212, 0.08) 0%, transparent 50%);
      pointer-events: none;
    }

    /* TARJETAS DE SELECCIÓN */
    .selection-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--glass-border);
      border-radius: 32px;
      padding: 40px;
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .selection-card:hover {
      background: rgba(255, 255, 255, 0.04);
      transform: translateY(-8px);
      box-shadow: 0 20px 60px -20px rgba(0,0,0,0.5);
    }

    /* Efecto de borde brillante al hover */
    .selection-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 32px;
      padding: 2px;
      background: linear-gradient(180deg, rgba(255,255,255,0.1), transparent);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.5;
      transition: opacity 0.3s;
    }
    .selection-card:hover::before { opacity: 1; }

    /* ESTILOS ESPECÍFICOS: EMPRESA */
    .card-empresa:hover { border-color: rgba(6, 182, 212, 0.3); }
    .card-empresa .icon-box { 
      color: var(--accent-cyan); 
      background: rgba(6, 182, 212, 0.1); 
      box-shadow: 0 0 30px rgba(6, 182, 212, 0.1);
    }
    
    /* ESTILOS ESPECÍFICOS: PERSONAL */
    .card-personal:hover { border-color: rgba(251, 191, 36, 0.3); }
    .card-personal .icon-box { 
      color: var(--accent-gold); 
      background: rgba(251, 191, 36, 0.1);
      box-shadow: 0 0 30px rgba(251, 191, 36, 0.1);
    }

    .icon-box {
      width: 80px; height: 80px;
      border-radius: 24px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 24px;
      transition: transform 0.3s ease;
    }
    .selection-card:hover .icon-box { transform: scale(1.1) rotate(5deg); }

    .btn-select {
      margin-top: auto;
      padding: 12px 28px;
      border-radius: 100px;
      font-weight: 700;
      font-size: 0.85rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: all 0.3s ease;
      opacity: 0.7;
    }
    .selection-card:hover .btn-select { opacity: 1; transform: scale(1.05); }

    .btn-empresa { background: rgba(6, 182, 212, 0.15); color: #22d3ee; border: 1px solid rgba(6, 182, 212, 0.3); }
    .btn-personal { background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); }

    /* MODAL DE CONFIRMACIÓN */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      z-index: 100; display: none; align-items: center; justify-content: center;
      opacity: 0; transition: opacity 0.3s ease;
    }
    .modal-backdrop.active { opacity: 1; }
    
    .modal-card {
      background: #0b0b14;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 32px;
      padding: 40px;
      width: 90%; max-width: 450px;
      text-align: center;
      transform: scale(0.95); transition: transform 0.3s ease;
    }
    .modal-backdrop.active .modal-card { transform: scale(1); }

    /* LOADER (Carga) */
    .loader-overlay {
      position: fixed; inset: 0; background: #030014; z-index: 200;
      display: none; align-items: center; justify-content: center; flex-direction: column;
    }
    .spinner {
      width: 50px; height: 50px;
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 50%;
      border-top-color: var(--accent-cyan);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

  </style>
</head>

<body class="p-6 md:p-12 justify-center items-center">

  <div class="nebula-bg"></div>

  <a href="/" class="absolute top-8 left-8 flex items-center gap-2 text-slate-500 hover:text-white transition font-medium text-sm z-20">
    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
    <span>Volver al Inicio</span>
  </a>

  <main class="w-full max-w-5xl z-10">
    <div class="text-center mb-16">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] uppercase tracking-widest text-slate-400 mb-6 font-bold">
        Configuración Inicial
      </div>
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 font-future leading-tight">Define tu Entorno</h1>
      <p class="text-slate-400 text-lg max-w-2xl mx-auto font-light">
        Selecciona cómo operarás en Pymax. Esta elección adaptará la Inteligencia Artificial a tus necesidades específicas.
      </p>
    </div>

    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
      
      <div onclick="abrirModal('empresa')" class="selection-card card-empresa group">
        <div class="icon-box">
          <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
        </div>
        <h3 class="text-2xl font-bold text-white mb-2 font-future">Modo Corporativo</h3>
        <p class="text-slate-400 text-sm mb-8 leading-relaxed">
          Diseñado para dueños de negocio. Control de flujo de caja, obligaciones, nómina y proyección estratégica a 90 días.
        </p>
        <button class="btn-select btn-empresa">Seleccionar Empresa</button>
      </div>

      <div onclick="abrirModal('personal')" class="selection-card card-personal group">
        <div class="icon-box">
          <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        </div>
        <h3 class="text-2xl font-bold text-white mb-2 font-future">Modo Personal</h3>
        <p class="text-slate-400 text-sm mb-8 leading-relaxed">
          Para individuos que buscan libertad. Gestión de presupuesto doméstico, mapa de sueños y crecimiento patrimonial.
        </p>
        <button class="btn-select btn-personal">Seleccionar Personal</button>
      </div>

    </div>
  </main>

  <div id="confirmationModal" class="modal-backdrop">
    <div class="modal-card">
      <h3 class="text-2xl font-bold text-white mb-4 font-future">¿Confirmar Selección?</h3>
      <p class="text-slate-400 mb-8 text-sm">
        Estás a punto de activar el entorno <strong id="modalRoleName" class="text-white"></strong>.
        <br>La IA se calibrará para este objetivo permanentemente.
      </p>
      <div class="flex flex-col gap-3">
        <button onclick="ejecutarSeleccion()" class="w-full py-3 bg-white text-black font-bold rounded-xl hover:bg-slate-200 transition">
          Confirmar y Entrar
        </button>
        <button onclick="cerrarModal()" class="w-full py-3 text-slate-500 font-bold hover:text-white transition">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <div id="loaderOverlay" class="loader-overlay">
    <div class="spinner"></div>
    <h3 class="text-xl font-bold text-white font-future mb-2 animate-pulse">Configurando Entorno...</h3>
    <p class="text-slate-500 text-xs uppercase tracking-widest">Estableciendo conexión segura</p>
  </div>

 <script>
    // Credenciales desde variables de entorno (configuradas en Render)
    const SU_URL = '{{ SUPABASE_URL }}';
    const SU_KEY = '{{ SUPABASE_KEY }}';
    // Si falla la carga de Supabase, no importa, seguimos adelante.
    let supabaseClient = null;
    try {
        supabaseClient = window.supabase.createClient(SU_URL, SU_KEY);
    } catch (e) {
        console.warn("Supabase no cargó, pero no detendremos la misión.");
    }

    let seleccionPendiente = null;

    // Abrir Modal
    function abrirModal(tipo) {
        seleccionPendiente = tipo;
        const texto = tipo === 'personal' ? 'PERSONAL' : 'EMPRESARIAL';
        document.getElementById('modalRoleName').innerText = texto;
        
        const modal = document.getElementById('confirmationModal');
        modal.style.display = 'flex';
        // Pequeño delay para la animación CSS
        setTimeout(() => modal.classList.add('active'), 10);
    }

    // Cerrar Modal
    function cerrarModal() {
        const modal = document.getElementById('confirmationModal');
        modal.classList.remove('active');
        setTimeout(() => modal.style.display = 'none', 300);
        seleccionPendiente = null;
    }

    // --- EJECUTAR SELECCIÓN (VERSIÓN BLINDADA) ---
    function ejecutarSeleccion() {
        if (!seleccionPendiente) return;

        // 1. UI: Mostrar Loader
        const modal = document.getElementById('confirmationModal');
        modal.classList.remove('active');
        document.getElementById('loaderOverlay').style.display = 'flex';

        // 2. ACTUALIZAR BASE DE DATOS (En segundo plano - Fuego y Olvido)
        // No usamos 'await' para que no frene la redirección si el internet está lento.
        if (supabaseClient) {
            supabaseClient.auth.getUser().then(({ data: { user } }) => {
                if (user) {
                    supabaseClient.from('user_profiles')
                        .upsert({ id: user.id, account_type: seleccionPendiente })
                        .then(() => console.log("Preferencia guardada en nube"));
                }
            });
        }

        // 3. REDIRECCIÓN FORZADA (PRIORIDAD MÁXIMA)
        console.log("Redirigiendo a: /configurar-preferencia/" + seleccionPendiente);
        
        // Esperamos 1 segundo solo para que se vea la animación de carga bonita
        setTimeout(() => {
            // Esta línea le grita al servidor Python: "¡CAMBIA DE RUTA AHORA!"
            window.location.replace("/configurar-preferencia/" + seleccionPendiente);
        }, 1000);
    }
  </script>
</body>
</html>