<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pymax | Goals & Milestones Achievement System</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- PYMAX CORE SYSTEMS -->
    <script src="/static/js/pymax-performance.js"></script>
    <script src="/static/js/pymax-i18n.js"></script>
    <script src="/static/js/pymax-data-manager.js"></script>
    <script src="/static/js/pymax-real-auth.js"></script>

    <style>
        :root {
            --bg-void: #020617;
            --bg-card: rgba(15, 23, 42, 0.6);
            --border-glass: rgba(255, 255, 255, 0.08);
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg-void);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        h1, h2, h3, h4 {
            font-family: 'Outfit', sans-serif;
            letter-spacing: -0.02em;
        }

        .nebula-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            background: radial-gradient(circle at 20% 50%, rgba(52, 211, 153, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(167, 139, 250, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .glass-card {
            background: var(--bg-card);
            border: 1px solid var(--border-glass);
            border-radius: 24px;
            backdrop-filter: blur(24px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* Goal Card - Mejorado */
        .goal-card {
            padding: 24px;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.1), rgba(34, 211, 238, 0.05));
            border: 1px solid rgba(52, 211, 153, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .goal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #34d399, #22d3ee);
        }

        .goal-card:hover {
            border-color: rgba(52, 211, 153, 0.5);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(52, 211, 153, 0.2);
        }

        /* Progress Ring */
        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.8s ease;
        }

        /* Progress Bar */
        .progress-bar-container {
            height: 12px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #34d399, #22d3ee);
            border-radius: 10px;
            transition: width 0.8s ease;
            box-shadow: 0 0 20px rgba(52, 211, 153, 0.5);
        }

        /* Milestone */
        .milestone-item {
            padding: 12px 16px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border-left: 3px solid #34d399;
            transition: all 0.2s ease;
        }

        .milestone-item:hover {
            background: rgba(52, 211, 153, 0.1);
            border-color: rgba(52, 211, 153, 0.3);
            transform: translateX(4px);
        }

        .milestone-item.completed {
            opacity: 0.6;
            border-left-color: #6ee7b7;
        }

        /* Achievement Badge */
        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2));
            border: 1px solid rgba(251, 191, 36, 0.4);
            color: #fcd34d;
        }

        /* Modern Button */
        .modern-btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #34d399, #10b981);
            color: white;
        }

        .btn-primary:hover {
            box-shadow: 0 0 30px rgba(52, 211, 153, 0.4);
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(52, 211, 153, 0.3); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(52, 211, 153, 0.5); }
    </style>
</head>

<body>
    <div class="nebula-bg"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full z-50 bg-[#020617]/90 backdrop-blur-md border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/empresa/mover" class="flex items-center gap-2 text-slate-400 hover:text-white transition group">
                    <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center border border-white/10 group-hover:border-white/30 transition">
                        <i class="ph-bold ph-arrow-left"></i>
                    </div>
                    <span class="hidden md:inline text-xs font-bold uppercase tracking-widest" data-i18n="back">Back</span>
                </a>
                <div class="h-6 w-px bg-white/10"></div>
                <h1 class="text-xl font-bold text-white font-display tracking-tight">
                    PYMAX <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">GOALS</span>
                </h1>
            </div>

            <div class="flex items-center gap-3">
                <div class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
                    <span class="text-xs font-semibold text-emerald-400" id="goalsCompleted">0/3</span>
                    <span class="text-xs text-slate-400">Completed</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 md:px-6 pt-24 pb-12 relative z-10">

        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 fade-in">
            <div class="glass-card p-6">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-xs font-bold uppercase tracking-widest text-slate-500" data-i18n="active_goals">Active Goals</p>
                    <i class="ph-duotone ph-target text-emerald-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white font-display mb-1" id="statActive">3</h3>
                <p class="text-xs text-slate-400" data-i18n="in_progress">In progress</p>
            </div>

            <div class="glass-card p-6">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-xs font-bold uppercase tracking-widest text-slate-500" data-i18n="avg_progress">Avg Progress</p>
                    <i class="ph-duotone ph-chart-line text-cyan-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white font-display mb-1" id="statProgress">67%</h3>
                <p class="text-xs text-slate-400" data-i18n="overall_completion">Overall completion</p>
            </div>

            <div class="glass-card p-6">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-xs font-bold uppercase tracking-widest text-slate-500" data-i18n="completed">Completed</p>
                    <i class="ph-duotone ph-check-circle text-emerald-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white font-display mb-1" id="statCompleted">12</h3>
                <p class="text-xs text-slate-400" data-i18n="all_time">All time</p>
            </div>

            <div class="glass-card p-6">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-xs font-bold uppercase tracking-widest text-slate-500" data-i18n="success_rate">Success Rate</p>
                    <i class="ph-duotone ph-trophy text-amber-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white font-display mb-1" id="statRate">85%</h3>
                <p class="text-xs text-slate-400" data-i18n="achievement_rate">Achievement rate</p>
            </div>
        </div>

        <div class="grid lg:grid-cols-12 gap-8">

            <!-- Left Column: Goals -->
            <div class="lg:col-span-8 space-y-6">

                <!-- Goal 1 -->
                <div class="goal-card fade-in">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                                    <i class="ph-fill ph-trophy text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white font-display" data-i18n="goal_primary">Primary Business Goal</h3>
                                    <p class="text-xs text-emerald-400 font-semibold uppercase tracking-wide" data-i18n="goal_type_strategic">Strategic Objective</p>
                                </div>
                            </div>
                        </div>
                        <button onclick="editGoal(1)" class="w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-slate-400 hover:text-white transition" data-i18n-title="edit" title="Edit">
                            <i class="ph-bold ph-pencil"></i>
                        </button>
                    </div>

                    <div class="p-4 bg-white/5 rounded-xl mb-4">
                        <p class="text-sm text-slate-200" id="goalText1" data-i18n="goal_placeholder_1">Set your main business objective for this quarter</p>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-slate-400 uppercase" data-i18n="progress">Progress</span>
                            <span class="text-sm font-bold text-emerald-400" id="goalProgress1">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="goalBar1" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-3 text-center text-xs">
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1" data-i18n="target_amount">Target</p>
                            <p class="font-bold text-white" id="goalTarget1">$50K</p>
                        </div>
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1" data-i18n="current_amount">Current</p>
                            <p class="font-bold text-cyan-400" id="goalCurrent1">$33.5K</p>
                        </div>
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1" data-i18n="days_left">Days Left</p>
                            <p class="font-bold text-amber-400" id="goalDays1">18</p>
                        </div>
                    </div>
                </div>

                <!-- Goal 2 -->
                <div class="goal-card fade-in" style="background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(59, 130, 246, 0.05)); border-color: rgba(96, 165, 250, 0.3);">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center">
                                    <i class="ph-fill ph-rocket text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white font-display" data-i18n="goal_secondary">Secondary Goal</h3>
                                    <p class="text-xs text-blue-400 font-semibold uppercase tracking-wide" data-i18n="goal_type_growth">Growth Initiative</p>
                                </div>
                            </div>
                        </div>
                        <button onclick="editGoal(2)" class="w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-slate-400 hover:text-white transition" data-i18n-title="edit" title="Edit">
                            <i class="ph-bold ph-pencil"></i>
                        </button>
                    </div>

                    <div class="p-4 bg-white/5 rounded-xl mb-4">
                        <p class="text-sm text-slate-200" id="goalText2" data-i18n="goal_placeholder_2">Define your secondary business objective</p>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-slate-400 uppercase" data-i18n="progress">Progress</span>
                            <span class="text-sm font-bold text-blue-400" id="goalProgress2">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="goalBar2" style="width: 0%; background: linear-gradient(90deg, #60a5fa, #3b82f6);"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-3 text-center text-xs">
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1" data-i18n="target_amount">Target</p>
                            <p class="font-bold text-white" id="goalTarget2">$30K</p>
                        </div>
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1" data-i18n="current_amount">Current</p>
                            <p class="font-bold text-blue-400" id="goalCurrent2">$22K</p>
                        </div>
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1" data-i18n="days_left">Days Left</p>
                            <p class="font-bold text-amber-400" id="goalDays2">32</p>
                        </div>
                    </div>
                </div>

                <!-- Goal 3 -->
                <div class="goal-card fade-in" style="background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(139, 92, 246, 0.05)); border-color: rgba(167, 139, 250, 0.3);">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center">
                                    <i class="ph-fill ph-lightning text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white font-display" data-i18n="goal_tertiary">Tertiary Goal</h3>
                                    <p class="text-xs text-violet-400 font-semibold uppercase tracking-wide" data-i18n="goal_type_expansion">Expansion Target</p>
                                </div>
                            </div>
                        </div>
                        <button onclick="editGoal(3)" class="w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-slate-400 hover:text-white transition" data-i18n-title="edit" title="Edit">
                            <i class="ph-bold ph-pencil"></i>
                        </button>
                    </div>

                    <div class="p-4 bg-white/5 rounded-xl mb-4">
                        <p class="text-sm text-slate-200" id="goalText3" data-i18n="goal_placeholder_3">Establish your long-term expansion goal</p>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-slate-400 uppercase" data-i18n="progress">Progress</span>
                            <span class="text-sm font-bold text-violet-400" id="goalProgress3">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="goalBar3" style="width: 0%; background: linear-gradient(90deg, #a78bfa, #8b5cf6);"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-3 text-center text-xs">
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1">Target</p>
                            <p class="font-bold text-white" id="goalTarget3">$100K</p>
                        </div>
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1">Current</p>
                            <p class="font-bold text-violet-400" id="goalCurrent3">$45K</p>
                        </div>
                        <div class="p-3 bg-white/5 rounded-lg">
                            <p class="text-slate-400 mb-1">Days Left</p>
                            <p class="font-bold text-amber-400" id="goalDays3">90</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column: Insights & Actions -->
            <div class="lg:col-span-4 space-y-6">

                <!-- Achievements -->
                <div class="glass-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-white font-display mb-4 flex items-center gap-2">
                        <i class="ph-duotone ph-medal text-amber-400"></i>
                        <span data-i18n="recent_achievements">Recent Achievements</span>
                    </h3>
                    
                    <div class="space-y-3 text-xs">
                        <div class="achievement-badge">
                            <i class="ph-fill ph-star"></i>
                            <span data-i18n="achievement_75">75% Goal Reached</span>
                        </div>
                        <div class="achievement-badge">
                            <i class="ph-fill ph-fire"></i>
                            <span data-i18n="achievement_streak">7-Day Streak</span>
                        </div>
                        <div class="achievement-badge">
                            <i class="ph-fill ph-crown"></i>
                            <span data-i18n="achievement_top">Top Performer</span>
                        </div>
                    </div>
                </div>

                <!-- Progress Chart -->
                <div class="glass-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-white font-display mb-4" data-i18n="progress_trend">Progress Trend</h3>
                    <div style="height: 200px;">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>

                <!-- Milestones -->
                <div class="glass-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-white font-display mb-4" data-i18n="key_milestones">Key Milestones</h3>
                    
                    <div class="space-y-2 custom-scroll" style="max-height: 300px;">
                        <div class="milestone-item completed">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="ph-fill ph-check-circle text-emerald-400"></i>
                                <p class="font-semibold text-white text-xs" data-i18n="milestone_q1">Q1 Revenue Target</p>
                            </div>
                            <p class="text-[10px] text-slate-400" data-i18n="completed_jan">Completed Jan 28</p>
                        </div>
                        <div class="milestone-item">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="ph-fill ph-circle text-cyan-400 pulse"></i>
                                <p class="font-semibold text-white text-xs" data-i18n="milestone_product">Launch New Product</p>
                            </div>
                            <p class="text-[10px] text-slate-400" data-i18n="due_12_days">Due in 12 days</p>
                        </div>
                        <div class="milestone-item">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="ph-fill ph-circle text-slate-600"></i>
                                <p class="font-semibold text-white text-xs" data-i18n="milestone_team">Expand Team</p>
                            </div>
                            <p class="text-[10px] text-slate-400" data-i18n="due_45_days">Due in 45 days</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="glass-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-white font-display mb-4" data-i18n="actions">Actions</h3>
                    <div class="space-y-3">
                        <button onclick="addMilestone()" class="w-full modern-btn btn-primary text-xs py-3">
                            <i class="ph-bold ph-plus-circle"></i>
                            <span data-i18n="add_milestone">Add Milestone</span>
                        </button>
                        <button onclick="viewTemplates()" class="w-full modern-btn text-xs py-3" style="background: rgba(255,255,255,0.05); color: #e2e8f0;">
                            <i class="ph-bold ph-lightbulb"></i>
                            <span data-i18n="goal_templates">Goal Templates</span>
                        </button>
                    </div>
                </div>

            </div>

        </div>

    </main>

    <!-- JavaScript -->
    <script>
        // Credenciales desde variables de entorno (configuradas en Render)
        const SU_URL = '{{ SUPABASE_URL }}';
        const SU_KEY = '{{ SUPABASE_KEY }}';
        const client = supabase.createClient(SU_URL, SU_KEY);

        let goals = { 1: null, 2: null, 3: null };
        let progressChart = null;

        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            background: '#0b0b14',
            color: '#fff'
        });

        document.addEventListener('DOMContentLoaded', async () => {
            const user = await checkRealAuth(client);
            if (!user) return;
            
            // Inicializar Data Manager
            const initOk = await pymaxData.init(client);
            if (!initOk) {
                loadDemoGoals();
                initializeChart();
                return;
            }
            
            pymaxData.on('data_updated', () => loadGoals());
            
            await loadGoals();
            initializeChart();
            
            // Actualizar al cambiar idioma
            window.addEventListener('languageChanged', () => {
                updateChartLabels();
            });
        });

        async function loadGoals() {
            try {
                const cachedGoals = pymaxData.getGoals ? pymaxData.getGoals() : null;
                
                if (cachedGoals) {
                    if (cachedGoals[1]) {
                        goals[1] = cachedGoals[1];
                        document.getElementById('goalText1').textContent = cachedGoals[1].goal_text;
                    }
                    if (cachedGoals[2]) {
                        goals[2] = cachedGoals[2];
                        document.getElementById('goalText2').textContent = cachedGoals[2].goal_text;
                    }
                    if (cachedGoals[3]) {
                        goals[3] = cachedGoals[3];
                        document.getElementById('goalText3').textContent = cachedGoals[3].goal_text;
                    }
                    updateStats();
                    return;
                }

                const { data: { user } } = await client.auth.getUser();
                if (!user) {
                    console.warn('No user found, using demo mode');
                    loadDemoGoals();
                    return;
                }

                // Load from Supabase (fallback si Data Manager no tiene datos)
                const { data: mainGoal } = await client
                    .from('user_goals')
                    .select('*')
                    .eq('user_id', user.id)
                    .maybeSingle();

                const { data: extraGoals } = await client
                    .from('user_goals_extra')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('slot_number');

                if (mainGoal) {
                    goals[1] = mainGoal;
                    document.getElementById('goalText1').textContent = mainGoal.goal_text;
                }

                if (extraGoals) {
                    extraGoals.forEach(g => {
                        goals[g.slot_number] = g;
                        document.getElementById(`goalText${g.slot_number}`).textContent = g.goal_text;
                    });
                }

                updateStats();

            } catch (error) {
                console.error('Error loading goals:', error);
                loadDemoGoals();
            }
        }

        function loadDemoGoals() {
            document.getElementById('goalText1').textContent = 'Achieve $50,000 in monthly revenue';
            document.getElementById('goalProgress1').textContent = '67%';
            document.getElementById('goalBar1').style.width = '67%';

            document.getElementById('goalText2').textContent = 'Launch 2 new products this quarter';
            document.getElementById('goalProgress2').textContent = '50%';
            document.getElementById('goalBar2').style.width = '50%';

            document.getElementById('goalText3').textContent = 'Expand to 3 new markets';
            document.getElementById('goalProgress3').textContent = '45%';
            document.getElementById('goalBar3').style.width = '45%';
        }

        function updateStats() {
            // Calculate average progress
            const progresses = [
                parseInt(document.getElementById('goalProgress1').textContent),
                parseInt(document.getElementById('goalProgress2').textContent),
                parseInt(document.getElementById('goalProgress3').textContent)
            ];

            const avgProgress = Math.round(progresses.reduce((a, b) => a + b, 0) / 3);
            document.getElementById('statProgress').textContent = avgProgress + '%';

            const completed = progresses.filter(p => p >= 100).length;
            document.getElementById('goalsCompleted').textContent = `${completed}/3`;
        }

        function initializeChart() {
            const ctx = document.getElementById('progressChart');
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Goal 1',
                        data: [20, 35, 52, 67],
                        borderColor: '#34d399',
                        backgroundColor: 'rgba(52, 211, 153, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Goal 2',
                        data: [15, 28, 40, 50],
                        borderColor: '#60a5fa',
                        backgroundColor: 'rgba(96, 165, 250, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Goal 3',
                        data: [10, 22, 35, 45],
                        borderColor: '#a78bfa',
                        backgroundColor: 'rgba(167, 139, 250, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { color: '#94a3b8', font: { size: 11 } }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#64748b', font: { size: 10 } }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { 
                                color: '#64748b',
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }

        async function editGoal(goalNumber) {
            const t = key => window.i18n?.t(key) || key;
            Swal.fire({
                title: `${t('edit_goal')} ${goalNumber}`,
                input: 'textarea',
                inputValue: document.getElementById(`goalText${goalNumber}`).textContent,
                inputPlaceholder: t('enter_goal_description'),
                showCancelButton: true,
                confirmButtonColor: '#34d399',
                cancelButtonColor: '#3f3f46',
                confirmButtonText: t('save_goal'),
                cancelButtonText: t('cancel'),
                background: '#0b0b14',
                color: '#fff'
            }).then(async (result) => {
                if (result.isConfirmed && result.value) {
                    document.getElementById(`goalText${goalNumber}`).textContent = result.value;
                    
                    if (pymaxData && pymaxData.updateGoal) {
                        const res = await pymaxData.updateGoal(goalNumber, { goal_text: result.value });
                        if (!res.success) {
                            Toast.fire({ icon: 'warning', title: t('operation_failed') });
                        }
                    }
                    Toast.fire({ icon: 'success', title: t('goal_updated') });
                }
            });
        }

        function addMilestone() {
            const t = key => window.i18n?.t(key) || key;
            Toast.fire({ icon: 'info', title: t('milestone_coming_soon') });
        }

        function updateChartLabels() {
            if (progressChart && window.i18n) {
                progressChart.data.datasets.forEach((ds, i) => {
                    ds.label = window.i18n.t('goals') + ' ' + (i + 1);
                });
                progressChart.update();
            }
        }

        function viewTemplates() {
            const t = key => window.i18n?.t(key) || key;
            Swal.fire({
                title: t('goal_templates'),
                html: `
                    <div class="text-left space-y-3">
                        <div class="p-3 bg-emerald-500/10 rounded-lg border border-emerald-500/30 cursor-pointer hover:bg-emerald-500/20 transition">
                            <p class="font-bold text-emerald-400 text-sm mb-1">Revenue Growth</p>
                            <p class="text-xs text-slate-400">Increase monthly revenue by 25%</p>
                        </div>
                        <div class="p-3 bg-blue-500/10 rounded-lg border border-blue-500/30 cursor-pointer hover:bg-blue-500/20 transition">
                            <p class="font-bold text-blue-400 text-sm mb-1">Market Expansion</p>
                            <p class="text-xs text-slate-400">Enter 2 new geographic markets</p>
                        </div>
                        <div class="p-3 bg-violet-500/10 rounded-lg border border-violet-500/30 cursor-pointer hover:bg-violet-500/20 transition">
                            <p class="font-bold text-violet-400 text-sm mb-1">Product Launch</p>
                            <p class="text-xs text-slate-400">Launch 3 new products this quarter</p>
                        </div>
                    </div>
                `,
                showCancelButton: false,
                confirmButtonColor: '#34d399',
                confirmButtonText: t('close'),
                background: '#0b0b14',
                color: '#fff',
                width: '500px'
            });
        }
    </script>
</body>
</html>
