<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pymax AI Assistant | Tu Consultor Financiero Premium</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    :root {
        --bg-void: #020617;
        --bg-card: rgba(15, 23, 42, 0.6);
        --border-glass: rgba(255, 255, 255, 0.08);
        --text-main: #e2e8f0;
        --text-muted: #94a3b8;
        --ai-glow: rgba(124, 58, 237, 0.6);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        background: var(--bg-void);
        color: var(--text-main);
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
        min-height: 100vh;
    }

    h1, h2, h3, h4, .font-display {
        font-family: 'Outfit', sans-serif;
        letter-spacing: -0.02em;
    }

    /* Aurora Background */
    @keyframes aurora-float {
      0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
      50% { transform: translate(30px, -30px) scale(1.15); opacity: 0.5; }
    }

    .aurora-blob {
      position: fixed;
      border-radius: 50%;
      filter: blur(120px);
      animation: aurora-float 15s infinite ease-in-out;
      z-index: 0;
      pointer-events: none;
    }

    .blob-purple { background: #7c3aed; width: 800px; height: 800px; top: -200px; left: 10%; }
    .blob-blue { background: #2563eb; width: 700px; height: 700px; bottom: -150px; right: 5%; animation-delay: 5s; }
    .blob-indigo { background: #4f46e5; width: 600px; height: 600px; top: 40%; right: -200px; animation-delay: 10s; }

    /* Glass Card */
    .glass-card {
        background: var(--bg-card);
        border: 1px solid var(--border-glass);
        border-radius: 24px;
        backdrop-filter: blur(24px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .glass-card:hover {
        border-color: rgba(255, 255, 255, 0.15);
    }

    /* AI Glow Effect */
    .ai-glow {
        box-shadow: 0 0 60px var(--ai-glow), inset 0 0 40px rgba(124, 58, 237, 0.1);
        border-color: rgba(124, 58, 237, 0.5);
    }

    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 40px var(--ai-glow); }
        50% { box-shadow: 0 0 80px var(--ai-glow); }
    }

    .pulse-glow {
        animation: pulse-glow 3s ease-in-out infinite;
    }

    /* Chat Messages */
    .msg-user {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        border-radius: 18px 18px 4px 18px;
        padding: 14px 18px;
        max-width: 80%;
        margin-left: auto;
    }

    .msg-ai {
        background: rgba(124, 58, 237, 0.15);
        border: 1px solid rgba(124, 58, 237, 0.3);
        border-radius: 18px 18px 18px 4px;
        padding: 16px 20px;
        max-width: 90%;
    }

    .msg-system {
        background: rgba(52, 211, 153, 0.1);
        border: 1px solid rgba(52, 211, 153, 0.3);
        border-radius: 16px;
        padding: 14px 18px;
        text-align: center;
        max-width: 100%;
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .msg-anim {
        animation: slideIn 0.4s ease-out forwards;
    }

    /* Quick Action Buttons */
    .quick-action {
        background: rgba(124, 58, 237, 0.1);
        border: 1px solid rgba(124, 58, 237, 0.3);
        border-radius: 12px;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.85rem;
    }

    .quick-action:hover {
        background: rgba(124, 58, 237, 0.2);
        border-color: rgba(124, 58, 237, 0.5);
        transform: translateY(-2px);
    }

    /* Stat Card */
    .stat-mini {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 12px;
        text-align: center;
    }

    /* Scrollbar */
    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: rgba(124, 58, 237, 0.4); border-radius: 10px; }
    .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(124, 58, 237, 0.6); }

    /* Modern Input */
    .modern-input {
        width: 100%;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 16px 20px;
        border-radius: 16px;
        color: white;
        outline: none;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .modern-input:focus {
        border-color: #7c3aed;
        box-shadow: 0 0 30px rgba(124, 58, 237, 0.3);
    }

    /* Category Badge */
    .category-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .category-badge:hover {
        transform: scale(1.05);
    }

    /* Typing Indicator */
    .typing-indicator {
        display: inline-flex;
        gap: 4px;
        padding: 12px 16px;
        background: rgba(124, 58, 237, 0.15);
        border: 1px solid rgba(124, 58, 237, 0.3);
        border-radius: 18px 18px 18px 4px;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background: #a78bfa;
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
        30% { transform: translateY(-10px); opacity: 1; }
    }

    /* Insights Section */
    .insight-card {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(59, 130, 246, 0.1));
        border: 1px solid rgba(124, 58, 237, 0.3);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 12px;
    }
  </style>
</head>

<body>
    <!-- Aurora Background -->
    <div class="aurora-blob blob-purple"></div>
    <div class="aurora-blob blob-blue"></div>
    <div class="aurora-blob blob-indigo"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full z-50 bg-[#020617]/90 backdrop-blur-md border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/empresa/mover" class="flex items-center gap-2 text-slate-400 hover:text-white transition group">
                    <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center border border-white/10 group-hover:border-white/30 transition">
                        <i class="ph-bold ph-arrow-left"></i>
                    </div>
                    <span class="hidden md:inline text-xs font-bold uppercase tracking-widest">Volver</span>
                </a>
                <div class="h-6 w-px bg-white/10"></div>
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center pulse-glow">
                        <i class="ph-fill ph-sparkle text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-sm font-bold text-white font-display">AI ASSISTANT</h1>
                        <p class="text-[10px] text-purple-400 font-semibold tracking-wide">PYMAX PREMIUM</p>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <div class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-purple-500/10 border border-purple-500/30">
                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                    <span class="text-xs font-bold text-purple-300">Plan B√°sico</span>
                </div>
                <button class="text-xs font-bold px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:shadow-lg transition">
                    <i class="ph-bold ph-crown"></i> Upgrade
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 md:px-6 pt-24 pb-8 relative z-10">
        
        <div class="grid lg:grid-cols-12 gap-6 h-[calc(100vh-140px)]">

            <!-- Left Sidebar: Quick Stats & Categories -->
            <div class="lg:col-span-3 space-y-4 overflow-y-auto custom-scroll">
                
                <!-- Quick Stats -->
                <div class="glass-card p-4">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-slate-500 mb-3">Tu Resumen</h3>
                    <div class="space-y-3">
                        <div class="stat-mini">
                            <i class="ph-duotone ph-currency-dollar text-emerald-400 text-2xl mb-1 block"></i>
                            <p class="text-xs text-slate-400">Balance</p>
                            <p class="text-sm font-bold text-white" id="aiBalance">$0</p>
                        </div>
                        <div class="stat-mini">
                            <i class="ph-duotone ph-warning text-amber-400 text-2xl mb-1 block"></i>
                            <p class="text-xs text-slate-400">Deudas Activas</p>
                            <p class="text-sm font-bold text-white" id="aiDebts">0</p>
                        </div>
                        <div class="stat-mini">
                            <i class="ph-duotone ph-target text-cyan-400 text-2xl mb-1 block"></i>
                            <p class="text-xs text-slate-400">Metas Activas</p>
                            <p class="text-sm font-bold text-white" id="aiGoals">3</p>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div class="glass-card p-4">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-slate-500 mb-3">Categor√≠as</h3>
                    <div class="space-y-2">
                        <div class="category-badge" style="background: rgba(52, 211, 153, 0.15); border: 1px solid rgba(52, 211, 153, 0.3); color: #6ee7b7;" onclick="sendQuickQuestion('finanzas')">
                            <i class="ph-fill ph-coins"></i>
                            <span>Finanzas</span>
                        </div>
                        <div class="category-badge" style="background: rgba(251, 113, 133, 0.15); border: 1px solid rgba(251, 113, 133, 0.3); color: #fca5a5;" onclick="sendQuickQuestion('deudas')">
                            <i class="ph-fill ph-warning"></i>
                            <span>Deudas</span>
                        </div>
                        <div class="category-badge" style="background: rgba(96, 165, 250, 0.15); border: 1px solid rgba(96, 165, 250, 0.3); color: #93c5fd;" onclick="sendQuickQuestion('estrategia')">
                            <i class="ph-fill ph-chart-line"></i>
                            <span>Estrategia</span>
                        </div>
                        <div class="category-badge" style="background: rgba(251, 191, 36, 0.15); border: 1px solid rgba(251, 191, 36, 0.3); color: #fcd34d;" onclick="sendQuickQuestion('impuestos')">
                            <i class="ph-fill ph-receipt"></i>
                            <span>Impuestos</span>
                        </div>
                        <div class="category-badge" style="background: rgba(168, 85, 247, 0.15); border: 1px solid rgba(168, 85, 247, 0.3); color: #c084fc;" onclick="sendQuickQuestion('crecimiento')">
                            <i class="ph-fill ph-rocket"></i>
                            <span>Crecimiento</span>
                        </div>
                    </div>
                </div>

                <!-- AI Insights -->
                <div class="glass-card p-4">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-slate-500 mb-3 flex items-center gap-2">
                        <i class="ph-duotone ph-lightbulb text-amber-400"></i>
                        Sugerencias IA
                    </h3>
                    <div class="space-y-2 text-xs text-slate-300" id="aiInsights">
                        <div class="insight-card">
                            <p class="font-semibold text-purple-300 mb-1">üí° Tip del d√≠a</p>
                            <p>Tus gastos han aumentado 12% este mes. Considera revisar tus suscripciones.</p>
                        </div>
                        <div class="insight-card">
                            <p class="font-semibold text-purple-300 mb-1">üìä An√°lisis</p>
                            <p>Tienes $2,500 en deudas venciendo esta semana.</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Main Chat Area -->
            <div class="lg:col-span-9 flex flex-col glass-card ai-glow">
                
                <!-- Chat Header -->
                <div class="p-4 border-b border-white/10 flex justify-between items-center bg-white/5">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center pulse-glow">
                            <i class="ph-fill ph-brain text-white text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-base font-bold text-white font-display">Consultor Pymax</h2>
                            <p class="text-xs text-purple-300">Asistente Financiero Inteligente</p>
                        </div>
                    </div>
                    <button onclick="clearChat()" class="text-xs px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition">
                        <i class="ph-bold ph-trash"></i> Limpiar
                    </button>
                </div>

                <!-- Chat Messages -->
                <div id="chatHistory" class="flex-1 p-6 overflow-y-auto custom-scroll space-y-4">
                    
                    <!-- Welcome Message -->
                    <div class="msg-system msg-anim">
                        <p class="text-sm font-semibold text-emerald-400 mb-1">üéâ ¬°Bienvenido a tu Asistente IA!</p>
                        <p class="text-xs text-slate-300">He analizado tu situaci√≥n financiera. Preg√∫ntame lo que necesites o usa las acciones r√°pidas.</p>
                    </div>

                    <!-- AI Initial Message -->
                    <div class="flex gap-3 msg-anim">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0">
                            <i class="ph-fill ph-sparkle text-white text-lg"></i>
                        </div>
                        <div class="msg-ai flex-1">
                            <p class="font-bold text-purple-300 mb-2 text-sm">Pymax AI</p>
                            <p class="text-sm text-slate-200 mb-3">
                                Hola üëã Soy tu consultor financiero inteligente. Tengo acceso a todos tus datos y puedo ayudarte con:
                            </p>
                            <ul class="text-sm text-slate-300 space-y-1.5 mb-3">
                                <li class="flex items-center gap-2">
                                    <i class="ph-fill ph-check-circle text-emerald-400"></i>
                                    An√°lisis de flujo de caja y liquidez
                                </li>
                                <li class="flex items-center gap-2">
                                    <i class="ph-fill ph-check-circle text-emerald-400"></i>
                                    Estrategias de pago de deudas
                                </li>
                                <li class="flex items-center gap-2">
                                    <i class="ph-fill ph-check-circle text-emerald-400"></i>
                                    Proyecciones financieras
                                </li>
                                <li class="flex items-center gap-2">
                                    <i class="ph-fill ph-check-circle text-emerald-400"></i>
                                    Optimizaci√≥n de impuestos
                                </li>
                                <li class="flex items-center gap-2">
                                    <i class="ph-fill ph-check-circle text-emerald-400"></i>
                                    Consejos de inversi√≥n y ahorro
                                </li>
                            </ul>
                            <p class="text-xs text-purple-200">¬øEn qu√© te puedo ayudar hoy?</p>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="grid md:grid-cols-2 gap-3 my-4" id="quickActions">
                        <div class="quick-action" onclick="sendQuickQuestion('¬øCu√°l es mi situaci√≥n financiera actual?')">
                            <i class="ph-fill ph-chart-pie-slice text-purple-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-sm">Estado Financiero</p>
                                <p class="text-xs text-slate-400">Ver resumen completo</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="sendQuickQuestion('¬øCu√°ndo debo pagar mis pr√≥ximas deudas?')">
                            <i class="ph-fill ph-calendar-check text-rose-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-sm">Pr√≥ximos Vencimientos</p>
                                <p class="text-xs text-slate-400">Calendario de pagos</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="sendQuickQuestion('Dame estrategias para reducir gastos')">
                            <i class="ph-fill ph-trend-down text-amber-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-sm">Reducir Gastos</p>
                                <p class="text-xs text-slate-400">Estrategias de ahorro</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="sendQuickQuestion('¬øC√≥mo puedo aumentar mis ingresos?')">
                            <i class="ph-fill ph-trend-up text-emerald-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-sm">Aumentar Ingresos</p>
                                <p class="text-xs text-slate-400">Ideas de crecimiento</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="sendQuickQuestion('Analiza mi flujo de caja de este mes')">
                            <i class="ph-fill ph-flow-arrow text-cyan-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-sm">Flujo de Caja</p>
                                <p class="text-xs text-slate-400">An√°lisis mensual</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="sendQuickQuestion('¬øQu√© impuestos debo preparar?')">
                            <i class="ph-fill ph-file-text text-indigo-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-sm">Impuestos</p>
                                <p class="text-xs text-slate-400">Preparaci√≥n fiscal</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Chat Input -->
                <div class="p-4 border-t border-white/10 bg-slate-900/80">
                    <div class="flex gap-3 items-end">
                        <div class="flex-1">
                            <input 
                                id="chatInput" 
                                type="text" 
                                placeholder="Escribe tu consulta aqu√≠... (ej: ¬øCu√°nto puedo ahorrar este mes?)" 
                                class="modern-input"
                                onkeypress="if(event.key === 'Enter') sendMessage()"
                            />
                        </div>
                        <button 
                            id="sendBtn" 
                            onclick="sendMessage()"
                            class="px-6 py-4 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold transition flex items-center gap-2 shadow-lg"
                        >
                            <span>Enviar</span>
                            <i class="ph-bold ph-paper-plane-tilt"></i>
                        </button>
                    </div>
                    <p class="text-center text-[10px] text-slate-500 mt-3 tracking-wide">
                        <i class="ph-fill ph-lock-key text-emerald-400"></i>
                        Respuestas generadas por IA ‚Ä¢ Plan B√°sico activo (l√≠mites aplicados)
                    </p>
                </div>

            </div>

        </div>

    </main>

    <!-- JavaScript -->
    <script>
        // Supabase Configuration
        const SU_URL = 'https://haqjuyagyvxynmulanhe.supabase.co';
        const SU_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhcWp1eWFneXZ4eW5tdWxhbmhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MjU0MjQsImV4cCI6MjA4MTQwMTQyNH0.3aSIfr3s5spESzEv_UAaqYkJzVyhbkK8ZpSlExY0A3g';
        const client = supabase.createClient(SU_URL, SU_KEY);

        let conversationHistory = [];

        // Toast Notification
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            background: '#0b0b14',
            color: '#fff'
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadUserStats();
        });

        // Load User Stats
        async function loadUserStats() {
            try {
                const { data: { user } } = await client.auth.getUser();
                if (!user) {
                    // Show demo data
                    return;
                }

                // Load operations
                const { data: operations } = await client
                    .from('user_operations')
                    .select('*')
                    .eq('user_id', user.id);

                if (operations && operations.length > 0) {
                    const income = operations.filter(o => o.type === 'ingreso').reduce((sum, o) => sum + parseFloat(o.amount || 0), 0);
                    const expense = operations.filter(o => o.type === 'gasto').reduce((sum, o) => sum + parseFloat(o.amount || 0), 0);
                    const balance = income - expense;

                    document.getElementById('aiBalance').textContent = `$${balance.toLocaleString('en-US', { minimumFractionDigits: 0 })}`;
                }

                // Load obligations
                const { data: debts } = await client
                    .from('obligaciones')
                    .select('*')
                    .eq('user_id', user.id)
                    .eq('estado', 'pendiente');

                if (debts) {
                    document.getElementById('aiDebts').textContent = debts.length;
                }

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Send Message
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addUserMessage(message);
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Simulate AI response (replace with actual API call)
            setTimeout(() => {
                hideTypingIndicator();
                generateAIResponse(message);
            }, 1500);

            // Hide quick actions after first message
            const quickActions = document.getElementById('quickActions');
            if (quickActions && quickActions.style.display !== 'none') {
                quickActions.style.display = 'none';
            }
        }

        // Send Quick Question
        function sendQuickQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        // Add User Message
        function addUserMessage(text) {
            const chatHistory = document.getElementById('chatHistory');
            const div = document.createElement('div');
            div.className = 'flex justify-end msg-anim';
            div.innerHTML = `
                <div class="msg-user">
                    <p class="text-sm text-white">${text}</p>
                </div>
            `;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Add AI Message
        function addAIMessage(text) {
            const chatHistory = document.getElementById('chatHistory');
            const div = document.createElement('div');
            div.className = 'flex gap-3 msg-anim';
            div.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0">
                    <i class="ph-fill ph-sparkle text-white text-lg"></i>
                </div>
                <div class="msg-ai flex-1">
                    <p class="font-bold text-purple-300 mb-2 text-sm">Pymax AI</p>
                    <div class="text-sm text-slate-200">${text}</div>
                </div>
            `;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Show Typing Indicator
        function showTypingIndicator() {
            const chatHistory = document.getElementById('chatHistory');
            const div = document.createElement('div');
            div.id = 'typingIndicator';
            div.className = 'flex gap-3';
            div.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0">
                    <i class="ph-fill ph-sparkle text-white text-lg"></i>
                </div>
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Hide Typing Indicator
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Generate AI Response (Placeholder)
        function generateAIResponse(userMessage) {
            const lowerMsg = userMessage.toLowerCase();
            
            let response = '';

            // Context-aware responses
            if (lowerMsg.includes('situaci√≥n') || lowerMsg.includes('estado') || lowerMsg.includes('resumen')) {
                response = `
                    <p class="mb-3">Bas√°ndome en tu actividad reciente:</p>
                    <div class="space-y-2 mb-3">
                        <div class="flex items-center justify-between p-2 bg-white/5 rounded-lg">
                            <span class="text-xs"><i class="ph-fill ph-arrow-up text-emerald-400"></i> Ingresos del mes:</span>
                            <span class="font-bold text-emerald-400">$8,500</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-white/5 rounded-lg">
                            <span class="text-xs"><i class="ph-fill ph-arrow-down text-rose-400"></i> Gastos del mes:</span>
                            <span class="font-bold text-rose-400">$6,200</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-purple-500/10 rounded-lg border border-purple-500/30">
                            <span class="text-xs"><i class="ph-fill ph-equals text-cyan-400"></i> Balance neto:</span>
                            <span class="font-bold text-cyan-400">+$2,300</span>
                        </div>
                    </div>
                    <p class="text-xs">‚úÖ Tu situaci√≥n es positiva este mes. Considera invertir ese excedente.</p>
                `;
            } else if (lowerMsg.includes('deuda') || lowerMsg.includes('pagar') || lowerMsg.includes('vencimiento')) {
                response = `
                    <p class="mb-3">üìÖ Tienes estas obligaciones pr√≥ximas:</p>
                    <div class="space-y-2 mb-3">
                        <div class="p-2 bg-rose-500/10 rounded-lg border border-rose-500/30">
                            <p class="text-xs font-bold text-rose-300">Pr√©stamo Bancario</p>
                            <p class="text-xs text-slate-400">Vence en 5 d√≠as ‚Ä¢ $1,200</p>
                        </div>
                        <div class="p-2 bg-amber-500/10 rounded-lg border border-amber-500/30">
                            <p class="text-xs font-bold text-amber-300">Tarjeta de Cr√©dito</p>
                            <p class="text-xs text-slate-400">Vence en 12 d√≠as ‚Ä¢ $850</p>
                        </div>
                    </div>
                    <p class="text-xs">üí° Recomiendo priorizar el pr√©stamo bancario por el vencimiento cercano.</p>
                `;
            } else if (lowerMsg.includes('gasto') || lowerMsg.includes('reducir') || lowerMsg.includes('ahorro')) {
                response = `
                    <p class="mb-3">üîç He analizado tus gastos y encontr√© oportunidades:</p>
                    <ul class="text-xs space-y-2 mb-3">
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-arrow-right text-amber-400 mt-0.5"></i>
                            <span>Suscripciones: $280/mes en servicios poco usados</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-arrow-right text-amber-400 mt-0.5"></i>
                            <span>Comidas fuera: $450/mes (30% m√°s que promedio)</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-arrow-right text-amber-400 mt-0.5"></i>
                            <span>Transporte: Considera alternativas m√°s econ√≥micas</span>
                        </li>
                    </ul>
                    <p class="text-xs">üí∞ Potencial de ahorro: <span class="font-bold text-emerald-400">~$730/mes</span></p>
                `;
            } else if (lowerMsg.includes('ingreso') || lowerMsg.includes('aumentar') || lowerMsg.includes('ganar')) {
                response = `
                    <p class="mb-3">üöÄ Ideas para aumentar tus ingresos:</p>
                    <div class="space-y-2 mb-3">
                        <div class="p-2 bg-emerald-500/10 rounded-lg border border-emerald-500/30">
                            <p class="text-xs font-bold text-emerald-300">1. Freelancing</p>
                            <p class="text-xs text-slate-400">Basado en tus habilidades, podr√≠as generar +$500/mes</p>
                        </div>
                        <div class="p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/30">
                            <p class="text-xs font-bold text-cyan-300">2. Inversiones</p>
                            <p class="text-xs text-slate-400">Con tu excedente mensual, considera fondos indexados</p>
                        </div>
                        <div class="p-2 bg-indigo-500/10 rounded-lg border border-indigo-500/30">
                            <p class="text-xs font-bold text-indigo-300">3. Productos Digitales</p>
                            <p class="text-xs text-slate-400">Crea y vende contenido en tu √°rea de expertise</p>
                        </div>
                    </div>
                `;
            } else if (lowerMsg.includes('flujo') || lowerMsg.includes('caja') || lowerMsg.includes('liquidez')) {
                response = `
                    <p class="mb-3">üìä An√°lisis de Flujo de Caja (√öltimos 30 d√≠as):</p>
                    <div class="space-y-2 mb-3">
                        <div class="flex justify-between items-center p-2 bg-white/5 rounded-lg">
                            <span class="text-xs">Entradas totales:</span>
                            <span class="font-bold text-emerald-400">+$8,500</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-white/5 rounded-lg">
                            <span class="text-xs">Salidas totales:</span>
                            <span class="font-bold text-rose-400">-$6,200</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/30">
                            <span class="text-xs font-bold">Flujo Neto:</span>
                            <span class="font-bold text-cyan-400">+$2,300</span>
                        </div>
                    </div>
                    <p class="text-xs">üìà Tendencia: Positiva (+15% vs mes anterior)</p>
                `;
            } else if (lowerMsg.includes('impuesto') || lowerMsg.includes('fiscal') || lowerMsg.includes('tax')) {
                response = `
                    <p class="mb-3">üìã Resumen Fiscal:</p>
                    <div class="space-y-2 mb-3">
                        <div class="p-2 bg-amber-500/10 rounded-lg border border-amber-500/30">
                            <p class="text-xs font-bold text-amber-300">Declaraci√≥n Mensual</p>
                            <p class="text-xs text-slate-400">Vence: 17 de Feb ‚Ä¢ Estimado: $450</p>
                        </div>
                        <div class="p-2 bg-indigo-500/10 rounded-lg border border-indigo-500/30">
                            <p class="text-xs font-bold text-indigo-300">IVA Acumulado</p>
                            <p class="text-xs text-slate-400">Por pagar: $890</p>
                        </div>
                    </div>
                    <p class="text-xs">üí° Aseg√∫rate de tener respaldos digitales de todas tus facturas.</p>
                `;
            } else {
                response = `
                    <p class="mb-2">Entiendo tu consulta. Actualmente estoy en fase beta y mis capacidades est√°n limitadas.</p>
                    <p class="text-xs">Usa las <strong>acciones r√°pidas</strong> para consultas m√°s espec√≠ficas o selecciona una categor√≠a en el men√∫ lateral.</p>
                    <div class="mt-3 p-3 bg-purple-500/10 rounded-lg border border-purple-500/30">
                        <p class="text-xs font-bold text-purple-300 mb-1">üéÅ Actualiza a Premium</p>
                        <p class="text-[11px] text-slate-400">Desbloquea respuestas ilimitadas, an√°lisis predictivo y recomendaciones personalizadas.</p>
                    </div>
                `;
            }

            addAIMessage(response);
        }

        // Clear Chat
        function clearChat() {
            Swal.fire({
                title: '¬øLimpiar conversaci√≥n?',
                text: 'Se borrar√°n todos los mensajes',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#7c3aed',
                cancelButtonColor: '#3f3f46',
                confirmButtonText: 'S√≠, limpiar',
                cancelButtonText: 'Cancelar',
                background: '#0b0b14',
                color: '#fff'
            }).then((result) => {
                if (result.isConfirmed) {
                    const chatHistory = document.getElementById('chatHistory');
                    chatHistory.innerHTML = `
                        <div class="msg-system msg-anim">
                            <p class="text-sm font-semibold text-emerald-400 mb-1">üîÑ Conversaci√≥n reiniciada</p>
                            <p class="text-xs text-slate-300">¬øEn qu√© te puedo ayudar?</p>
                        </div>
                    `;
                    document.getElementById('quickActions').style.display = 'grid';
                    Toast.fire({ icon: 'success', title: 'Chat limpiado' });
                }
            });
        }

        // Keyboard shortcut
        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && e.ctrlKey) {
                e.preventDefault();
                document.getElementById('chatInput').focus();
            }
        });
    </script>
</body>
</html>
