<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pymax AI Assistant | Enterprise Financial Advisory</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    :root {
        --bg-void: #0a0e1a;
        --bg-surface: #131720;
        --bg-card: #1a1f2e;
        --border-primary: #2a3142;
        --text-primary: #e8eaf0;
        --text-secondary: #9ca3af;
        --text-muted: #6b7280;
        --accent-blue: #3b82f6;
        --accent-cyan: #06b6d4;
        --accent-purple: #8b5cf6;
        --accent-emerald: #10b981;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        background: var(--bg-void);
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
        min-height: 100vh;
    }

    h1, h2, h3, h4 {
        font-family: 'Inter', sans-serif;
        letter-spacing: -0.02em;
        font-weight: 700;
    }

    .mono {
        font-family: 'JetBrains Mono', monospace;
    }

    /* Gradient Background */
    .gradient-bg {
        position: fixed;
        inset: 0;
        z-index: 0;
        background: linear-gradient(180deg, #0a0e1a 0%, #131720 50%, #1a1f2e 100%);
        pointer-events: none;
    }

    .gradient-bg::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
    }

    /* Professional Card */
    .pro-card {
        background: var(--bg-card);
        border: 1px solid var(--border-primary);
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .pro-card:hover {
        border-color: rgba(59, 130, 246, 0.3);
    }

    /* Message Bubbles */
    .msg-user {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        border-radius: 12px 12px 2px 12px;
        padding: 14px 18px;
        max-width: 75%;
        margin-left: auto;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }

    .msg-ai {
        background: var(--bg-card);
        border: 1px solid var(--border-primary);
        border-radius: 12px 12px 12px 2px;
        padding: 16px 20px;
        max-width: 85%;
    }

    .msg-system {
        background: rgba(16, 185, 129, 0.08);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        max-width: 100%;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .msg-anim {
        animation: slideUp 0.3s ease-out forwards;
    }

    /* Quick Action Card */
    .quick-card {
        background: var(--bg-surface);
        border: 1px solid var(--border-primary);
        border-radius: 10px;
        padding: 14px 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .quick-card:hover {
        background: var(--bg-card);
        border-color: rgba(59, 130, 246, 0.4);
        transform: translateX(4px);
    }

    /* Stat Card */
    .stat-card {
        background: var(--bg-surface);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        padding: 14px;
        text-align: center;
    }

    /* Category Badge */
    .category-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid transparent;
    }

    .category-badge:hover {
        transform: translateY(-1px);
    }

    /* Typing Indicator */
    .typing-indicator {
        display: inline-flex;
        gap: 4px;
        padding: 10px 14px;
        background: var(--bg-card);
        border: 1px solid var(--border-primary);
        border-radius: 12px 12px 12px 2px;
    }

    .typing-dot {
        width: 6px;
        height: 6px;
        background: var(--accent-blue);
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
        30% { transform: translateY(-8px); opacity: 1; }
    }

    /* Insight Card */
    .insight-card {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 10px;
        padding: 14px;
        margin-bottom: 10px;
    }

    /* Modern Input */
    .modern-input {
        width: 100%;
        background: var(--bg-surface);
        border: 1px solid var(--border-primary);
        padding: 14px 18px;
        border-radius: 10px;
        color: var(--text-primary);
        outline: none;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .modern-input:focus {
        border-color: var(--accent-blue);
        background: var(--bg-card);
    }

    /* Scrollbar */
    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: var(--bg-surface); }
    .custom-scroll::-webkit-scrollbar-thumb { background: var(--border-primary); border-radius: 10px; }
    .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(59, 130, 246, 0.4); }

    /* Status Indicator */
    .status-indicator {
        width: 8px;
        height: 8px;
        background: var(--accent-emerald);
        border-radius: 50%;
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.1); }
    }

    /* Data Table */
    .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
        margin: 12px 0;
    }

    .data-table td {
        padding: 8px 12px;
        border-bottom: 1px solid var(--border-primary);
    }

    .data-table td:first-child {
        color: var(--text-secondary);
        font-weight: 500;
    }

    .data-table td:last-child {
        text-align: right;
        font-weight: 600;
    }

    /* Metric Bar */
    .metric-bar {
        background: var(--bg-surface);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        padding: 10px 14px;
        display: flex;
        justify-content: between;
        align-items: center;
    }
  </style>
</head>

<body>
    <div class="gradient-bg"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full z-50 bg-[#0a0e1a]/95 backdrop-blur-md border-b border-[#2a3142]">
        <div class="max-w-7xl mx-auto px-4 md:px-6 h-14 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/empresa/mover" class="flex items-center gap-2 text-gray-400 hover:text-white transition">
                    <div class="w-7 h-7 rounded-lg bg-white/5 flex items-center justify-center border border-white/10 hover:border-white/20 transition">
                        <i class="ph-bold ph-arrow-left text-sm"></i>
                    </div>
                    <span class="hidden md:inline text-xs font-semibold uppercase tracking-wider">Back</span>
                </a>
                <div class="h-5 w-px bg-white/10"></div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center">
                        <i class="ph-fill ph-robot text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-sm font-bold text-white">AI ASSISTANT</h1>
                        <p class="text-[9px] text-blue-400 font-semibold tracking-wider">FINANCIAL ADVISORY</p>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <div class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
                    <div class="status-indicator"></div>
                    <span class="text-xs font-semibold text-emerald-400 mono">ONLINE</span>
                </div>
                <button onclick="showUpgradeModal()" class="text-xs font-bold px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white transition">
                    Upgrade
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 md:px-6 pt-20 pb-8 relative z-10">
        
        <div class="grid lg:grid-cols-12 gap-6 h-[calc(100vh-140px)]">

            <!-- Left Sidebar -->
            <div class="lg:col-span-3 space-y-4 overflow-y-auto custom-scroll">
                
                <!-- Quick Stats -->
                <div class="pro-card p-4">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3">System Overview</h3>
                    <div class="space-y-3">
                        <div class="stat-card">
                            <i class="ph-duotone ph-coins text-emerald-400 text-2xl mb-1 block"></i>
                            <p class="text-[10px] text-gray-400 mb-1 uppercase tracking-wide">Current Balance</p>
                            <p class="text-sm font-bold text-white mono" id="aiBalance">$0</p>
                        </div>
                        <div class="stat-card">
                            <i class="ph-duotone ph-warning-circle text-amber-400 text-2xl mb-1 block"></i>
                            <p class="text-[10px] text-gray-400 mb-1 uppercase tracking-wide">Active Obligations</p>
                            <p class="text-sm font-bold text-white mono" id="aiDebts">0</p>
                        </div>
                        <div class="stat-card">
                            <i class="ph-duotone ph-target text-cyan-400 text-2xl mb-1 block"></i>
                            <p class="text-[10px] text-gray-400 mb-1 uppercase tracking-wide">Active Goals</p>
                            <p class="text-sm font-bold text-white mono" id="aiGoals">3</p>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div class="pro-card p-4">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3">Query Categories</h3>
                    <div class="space-y-2">
                        <div class="category-badge" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3); color: #6ee7b7;" onclick="sendQuickQuestion('Financial Overview')">
                            <i class="ph-fill ph-currency-dollar"></i>
                            <span>Financial</span>
                        </div>
                        <div class="category-badge" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: #fca5a5;" onclick="sendQuickQuestion('Debt Management')">
                            <i class="ph-fill ph-warning"></i>
                            <span>Obligations</span>
                        </div>
                        <div class="category-badge" style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); color: #93c5fd;" onclick="sendQuickQuestion('Strategic Planning')">
                            <i class="ph-fill ph-chart-line"></i>
                            <span>Strategy</span>
                        </div>
                        <div class="category-badge" style="background: rgba(234, 179, 8, 0.1); border-color: rgba(234, 179, 8, 0.3); color: #fde047;" onclick="sendQuickQuestion('Tax Planning')">
                            <i class="ph-fill ph-receipt-x"></i>
                            <span>Tax</span>
                        </div>
                        <div class="category-badge" style="background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3); color: #c4b5fd;" onclick="sendQuickQuestion('Growth Strategy')">
                            <i class="ph-fill ph-trend-up"></i>
                            <span>Growth</span>
                        </div>
                    </div>
                </div>

                <!-- AI Insights -->
                <div class="pro-card p-4">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center gap-2">
                        <i class="ph-duotone ph-lightbulb-filament text-amber-400"></i>
                        Intelligence Insights
                    </h3>
                    <div class="space-y-2 text-xs" id="aiInsights">
                        <div class="insight-card">
                            <p class="font-semibold text-blue-400 mb-1 text-[10px] uppercase tracking-wide">Alert</p>
                            <p class="text-gray-300 text-xs">Expenses increased 12% this month. Review recurring subscriptions.</p>
                        </div>
                        <div class="insight-card">
                            <p class="font-semibold text-blue-400 mb-1 text-[10px] uppercase tracking-wide">Analysis</p>
                            <p class="text-gray-300 text-xs">$2,500 in obligations due this week. Ensure sufficient liquidity.</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Main Chat Area -->
            <div class="lg:col-span-9 flex flex-col pro-card overflow-hidden">
                
                <!-- Chat Header -->
                <div class="p-4 border-b border-[#2a3142] flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center">
                            <i class="ph-fill ph-brain text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-sm font-bold text-white">Financial Advisory Console</h2>
                            <p class="text-[10px] text-gray-400 uppercase tracking-wide">Real-time Analysis System</p>
                        </div>
                    </div>
                    <button onclick="clearChat()" class="text-xs px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition border border-white/5">
                        <i class="ph-bold ph-trash"></i> Clear
                    </button>
                </div>

                <!-- Chat Messages -->
                <div id="chatHistory" class="flex-1 p-6 overflow-y-auto custom-scroll space-y-4">
                    
                    <!-- System Message -->
                    <div class="msg-system msg-anim">
                        <p class="text-xs font-semibold text-emerald-400 mb-1 uppercase tracking-wide">System Initialized</p>
                        <p class="text-xs text-gray-300">Financial data loaded. Advisory system ready.</p>
                    </div>

                    <!-- AI Initial Message -->
                    <div class="flex gap-3 msg-anim">
                        <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center flex-shrink-0">
                            <i class="ph-fill ph-robot text-white text-lg"></i>
                        </div>
                        <div class="msg-ai flex-1">
                            <p class="font-bold text-blue-400 mb-2 text-xs uppercase tracking-wide">AI Advisory</p>
                            <p class="text-sm text-gray-200 mb-3">
                                Financial advisory system activated. I have full access to your operational data and can provide analysis on:
                            </p>
                            <ul class="text-sm text-gray-300 space-y-1.5 mb-3 ml-4">
                                <li class="flex items-start gap-2">
                                    <i class="ph-fill ph-check text-emerald-400 mt-0.5"></i>
                                    <span>Cash flow analysis and liquidity management</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="ph-fill ph-check text-emerald-400 mt-0.5"></i>
                                    <span>Debt optimization and payment strategies</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="ph-fill ph-check text-emerald-400 mt-0.5"></i>
                                    <span>Financial projections and forecasting</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="ph-fill ph-check text-emerald-400 mt-0.5"></i>
                                    <span>Tax planning and compliance optimization</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="ph-fill ph-check text-emerald-400 mt-0.5"></i>
                                    <span>Investment recommendations and portfolio analysis</span>
                                </li>
                            </ul>
                            <p class="text-xs text-blue-300">Select a quick action or enter your query below.</p>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="grid md:grid-cols-2 gap-3 my-4" id="quickActions">
                        <div class="quick-card" onclick="sendQuickQuestion('Provide comprehensive financial status report')">
                            <i class="ph-fill ph-chart-pie-slice text-blue-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-xs">Financial Status</p>
                                <p class="text-[10px] text-gray-500">Comprehensive overview</p>
                            </div>
                        </div>
                        <div class="quick-card" onclick="sendQuickQuestion('List upcoming payment obligations')">
                            <i class="ph-fill ph-calendar-check text-rose-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-xs">Payment Schedule</p>
                                <p class="text-[10px] text-gray-500">Upcoming obligations</p>
                            </div>
                        </div>
                        <div class="quick-card" onclick="sendQuickQuestion('Analyze expense reduction opportunities')">
                            <i class="ph-fill ph-trend-down text-amber-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-xs">Cost Optimization</p>
                                <p class="text-[10px] text-gray-500">Reduction strategies</p>
                            </div>
                        </div>
                        <div class="quick-card" onclick="sendQuickQuestion('Revenue growth recommendations')">
                            <i class="ph-fill ph-trend-up text-emerald-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-xs">Revenue Growth</p>
                                <p class="text-[10px] text-gray-500">Expansion opportunities</p>
                            </div>
                        </div>
                        <div class="quick-card" onclick="sendQuickQuestion('Monthly cash flow analysis')">
                            <i class="ph-fill ph-flow-arrow text-cyan-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-xs">Cash Flow</p>
                                <p class="text-[10px] text-gray-500">Monthly analysis</p>
                            </div>
                        </div>
                        <div class="quick-card" onclick="sendQuickQuestion('Tax preparation requirements')">
                            <i class="ph-fill ph-file-text text-indigo-400 text-xl"></i>
                            <div class="flex-1">
                                <p class="font-bold text-white text-xs">Tax Planning</p>
                                <p class="text-[10px] text-gray-500">Compliance preparation</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Chat Input -->
                <div class="p-4 border-t border-[#2a3142]">
                    <div class="flex gap-3 items-end">
                        <div class="flex-1">
                            <input 
                                id="chatInput" 
                                type="text" 
                                placeholder="Enter your financial query..." 
                                class="modern-input"
                                onkeypress="if(event.key === 'Enter') sendMessage()"
                            />
                        </div>
                        <button 
                            id="sendBtn" 
                            onclick="sendMessage()"
                            class="px-5 py-3.5 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold transition flex items-center gap-2"
                        >
                            <span class="text-sm">Send</span>
                            <i class="ph-bold ph-paper-plane-tilt"></i>
                        </button>
                    </div>
                    <p class="text-center text-[9px] text-gray-600 mt-3 tracking-wide uppercase">
                        <i class="ph-fill ph-lock-key text-emerald-400"></i>
                        Secure AI Analysis | Basic Tier Active
                    </p>
                </div>

            </div>

        </div>

    </main>

    <!-- JavaScript -->
    <script>
        const SU_URL = 'https://haqjuyagyvxynmulanhe.supabase.co';
        const SU_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhcWp1eWFneXZ4eW5tdWxhbmhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MjU0MjQsImV4cCI6MjA4MTQwMTQyNH0.3aSIfr3s5spESzEv_UAaqYkJzVyhbkK8ZpSlExY0A3g';
        const client = supabase.createClient(SU_URL, SU_KEY);

        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            background: '#1a1f2e',
            color: '#fff'
        });

        document.addEventListener('DOMContentLoaded', async () => {
            await loadUserStats();
        });

        async function loadUserStats() {
            try {
                const { data: { user } } = await client.auth.getUser();
                if (!user) return;

                const { data: operations } = await client
                    .from('user_operations')
                    .select('*')
                    .eq('user_id', user.id);

                if (operations && operations.length > 0) {
                    const income = operations.filter(o => o.type === 'ingreso').reduce((sum, o) => sum + parseFloat(o.amount || 0), 0);
                    const expense = operations.filter(o => o.type === 'gasto').reduce((sum, o) => sum + parseFloat(o.amount || 0), 0);
                    const balance = income - expense;
                    document.getElementById('aiBalance').textContent = `$${balance.toLocaleString('en-US', { minimumFractionDigits: 0 })}`;
                }

                const { data: debts } = await client
                    .from('obligaciones')
                    .select('*')
                    .eq('user_id', user.id)
                    .eq('estado', 'pendiente');

                if (debts) {
                    document.getElementById('aiDebts').textContent = debts.length;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            addUserMessage(message);
            input.value = '';

            showTypingIndicator();

            setTimeout(() => {
                hideTypingIndicator();
                generateAIResponse(message);
            }, 1500);

            const quickActions = document.getElementById('quickActions');
            if (quickActions && quickActions.style.display !== 'none') {
                quickActions.style.display = 'none';
            }
        }

        function sendQuickQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        function addUserMessage(text) {
            const chatHistory = document.getElementById('chatHistory');
            const div = document.createElement('div');
            div.className = 'flex justify-end msg-anim';
            div.innerHTML = `
                <div class="msg-user">
                    <p class="text-sm text-white">${text}</p>
                </div>
            `;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function addAIMessage(text) {
            const chatHistory = document.getElementById('chatHistory');
            const div = document.createElement('div');
            div.className = 'flex gap-3 msg-anim';
            div.innerHTML = `
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center flex-shrink-0">
                    <i class="ph-fill ph-robot text-white text-lg"></i>
                </div>
                <div class="msg-ai flex-1">
                    <p class="font-bold text-blue-400 mb-2 text-xs uppercase tracking-wide">AI Advisory</p>
                    <div class="text-sm text-gray-200">${text}</div>
                </div>
            `;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function showTypingIndicator() {
            const chatHistory = document.getElementById('chatHistory');
            const div = document.createElement('div');
            div.id = 'typingIndicator';
            div.className = 'flex gap-3';
            div.innerHTML = `
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center flex-shrink-0">
                    <i class="ph-fill ph-robot text-white text-lg"></i>
                </div>
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function generateAIResponse(userMessage) {
            const lowerMsg = userMessage.toLowerCase();
            
            let response = '';

            if (lowerMsg.includes('status') || lowerMsg.includes('overview') || lowerMsg.includes('report')) {
                response = `
                    <p class="mb-3">Based on your current financial data:</p>
                    <table class="data-table">
                        <tr>
                            <td>Monthly Income</td>
                            <td class="text-emerald-400">$8,500</td>
                        </tr>
                        <tr>
                            <td>Monthly Expenses</td>
                            <td class="text-rose-400">$6,200</td>
                        </tr>
                        <tr>
                            <td>Net Cash Flow</td>
                            <td class="text-cyan-400">+$2,300</td>
                        </tr>
                        <tr>
                            <td>Savings Rate</td>
                            <td class="text-blue-400">27.1%</td>
                        </tr>
                    </table>
                    <p class="text-xs text-gray-400 mt-3">Status: Positive cash flow maintained. Recommend allocating excess towards debt reduction or investment.</p>
                `;
            } else if (lowerMsg.includes('debt') || lowerMsg.includes('payment') || lowerMsg.includes('obligation')) {
                response = `
                    <p class="mb-3">Upcoming payment obligations:</p>
                    <div class="space-y-2 mb-3">
                        <div class="metric-bar">
                            <div>
                                <p class="text-xs font-semibold text-white">Bank Loan</p>
                                <p class="text-[10px] text-gray-500">Due in 5 days</p>
                            </div>
                            <span class="font-bold text-rose-400 mono">$1,200</span>
                        </div>
                        <div class="metric-bar">
                            <div>
                                <p class="text-xs font-semibold text-white">Credit Card</p>
                                <p class="text-[10px] text-gray-500">Due in 12 days</p>
                            </div>
                            <span class="font-bold text-amber-400 mono">$850</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400">Recommendation: Prioritize bank loan due to proximity. Ensure $1,200 liquidity by end of week.</p>
                `;
            } else if (lowerMsg.includes('expense') || lowerMsg.includes('cost') || lowerMsg.includes('reduction')) {
                response = `
                    <p class="mb-3">Cost optimization analysis identified:</p>
                    <ul class="text-xs space-y-2 mb-3">
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-caret-right text-amber-400 mt-0.5"></i>
                            <span>Subscriptions: $280/month in underutilized services</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-caret-right text-amber-400 mt-0.5"></i>
                            <span>Food expenses: $450/month, 30% above category average</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-caret-right text-amber-400 mt-0.5"></i>
                            <span>Transportation: Consider alternative cost-efficient options</span>
                        </li>
                    </ul>
                    <p class="text-xs text-gray-400">Potential monthly savings: <span class="font-bold text-emerald-400">$730</span></p>
                `;
            } else if (lowerMsg.includes('revenue') || lowerMsg.includes('income') || lowerMsg.includes('growth')) {
                response = `
                    <p class="mb-3">Revenue growth opportunities:</p>
                    <div class="space-y-2 mb-3">
                        <div class="insight-card">
                            <p class="text-xs font-bold text-emerald-300">Freelancing Services</p>
                            <p class="text-[10px] text-gray-400">Based on skillset analysis, potential +$500/month</p>
                        </div>
                        <div class="insight-card">
                            <p class="text-xs font-bold text-cyan-300">Investment Portfolio</p>
                            <p class="text-[10px] text-gray-400">Monthly excess can generate estimated 6-8% annual return</p>
                        </div>
                        <div class="insight-card">
                            <p class="text-xs font-bold text-indigo-300">Digital Products</p>
                            <p class="text-[10px] text-gray-400">Monetize expertise through content creation</p>
                        </div>
                    </div>
                `;
            } else if (lowerMsg.includes('cash') || lowerMsg.includes('flow') || lowerMsg.includes('liquidity')) {
                response = `
                    <p class="mb-3">30-day cash flow analysis:</p>
                    <table class="data-table">
                        <tr>
                            <td>Total Inflows</td>
                            <td class="text-emerald-400">+$8,500</td>
                        </tr>
                        <tr>
                            <td>Total Outflows</td>
                            <td class="text-rose-400">-$6,200</td>
                        </tr>
                        <tr>
                            <td>Net Position</td>
                            <td class="text-cyan-400">+$2,300</td>
                        </tr>
                    </table>
                    <p class="text-xs text-gray-400 mt-3">Trend: Positive cash flow, +15% vs previous period</p>
                `;
            } else if (lowerMsg.includes('tax') || lowerMsg.includes('fiscal') || lowerMsg.includes('compliance')) {
                response = `
                    <p class="mb-3">Tax compliance summary:</p>
                    <div class="space-y-2 mb-3">
                        <div class="metric-bar">
                            <div>
                                <p class="text-xs font-semibold text-white">Monthly Declaration</p>
                                <p class="text-[10px] text-gray-500">Due: February 17</p>
                            </div>
                            <span class="font-bold text-amber-400 mono">$450</span>
                        </div>
                        <div class="metric-bar">
                            <div>
                                <p class="text-xs font-semibold text-white">VAT Accumulated</p>
                                <p class="text-[10px] text-gray-500">Quarterly payment</p>
                            </div>
                            <span class="font-bold text-indigo-400 mono">$890</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400">Ensure digital invoice backups are maintained for audit purposes.</p>
                `;
            } else {
                response = `
                    <p class="mb-2">Query received. Current system capabilities are limited to predefined analysis categories.</p>
                    <p class="text-xs text-gray-400">Use quick actions for specific financial analysis or select a category from the sidebar.</p>
                    <div class="mt-3 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20">
                        <p class="text-xs font-bold text-blue-400 mb-1 uppercase tracking-wide">Premium Upgrade</p>
                        <p class="text-[10px] text-gray-400">Unlock unlimited queries, predictive analysis, and personalized recommendations.</p>
                    </div>
                `;
            }

            addAIMessage(response);
        }

        function clearChat() {
            Swal.fire({
                title: 'Clear Conversation?',
                text: 'All messages will be removed',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#3f3f46',
                confirmButtonText: 'Clear',
                cancelButtonText: 'Cancel',
                background: '#1a1f2e',
                color: '#fff'
            }).then((result) => {
                if (result.isConfirmed) {
                    const chatHistory = document.getElementById('chatHistory');
                    chatHistory.innerHTML = `
                        <div class="msg-system msg-anim">
                            <p class="text-xs font-semibold text-emerald-400 mb-1 uppercase tracking-wide">System Reset</p>
                            <p class="text-xs text-gray-300">Conversation cleared. Ready for new queries.</p>
                        </div>
                    `;
                    document.getElementById('quickActions').style.display = 'grid';
                    Toast.fire({ icon: 'success', title: 'Chat cleared' });
                }
            });
        }

        function showUpgradeModal() {
            Swal.fire({
                title: 'Upgrade to Premium',
                html: `
                    <div class="text-left space-y-4 p-4">
                        <p class="text-sm text-gray-400 mb-4">
                            Unlock advanced AI capabilities and comprehensive financial analysis.
                        </p>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <i class="ph-fill ph-check-circle text-emerald-400 text-xl"></i>
                                <span class="text-sm text-gray-300">Unlimited Query Access</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="ph-fill ph-check-circle text-emerald-400 text-xl"></i>
                                <span class="text-sm text-gray-300">Predictive Financial Modeling</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="ph-fill ph-check-circle text-emerald-400 text-xl"></i>
                                <span class="text-sm text-gray-300">Personalized Recommendations</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="ph-fill ph-check-circle text-emerald-400 text-xl"></i>
                                <span class="text-sm text-gray-300">Advanced Analytics Dashboard</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="ph-fill ph-check-circle text-emerald-400 text-xl"></i>
                                <span class="text-sm text-gray-300">Priority Support</span>
                            </div>
                        </div>
                        <div class="mt-6 p-4 bg-blue-500/10 rounded-lg border border-blue-500/30">
                            <p class="text-center text-2xl font-bold text-white mb-1">$39/month</p>
                            <p class="text-center text-xs text-gray-400">or $390/year (save 17%)</p>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#3f3f46',
                confirmButtonText: 'Contact Sales',
                cancelButtonText: 'Later',
                background: '#1a1f2e',
                color: '#fff'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = 'mailto:sales@pymax.com?subject=Premium AI Upgrade';
                }
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && e.ctrlKey) {
                e.preventDefault();
                document.getElementById('chatInput').focus();
            }
        });
    </script>
</body>
</html>
